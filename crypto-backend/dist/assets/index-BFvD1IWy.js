import{g as Re}from"./index-BP3VuBPH.js";import we from"events";import Y from"net";import Oe from"buffer";import Ae from"stream";import{a as ye,r as Ce}from"./index-BveCBdm5.js";import Te from"dns";import Ne from"tls";import Ue from"url";function Pe(c,E){for(var m=0;m<E.length;m++){const g=E[m];if(typeof g!="string"&&!Array.isArray(g)){for(const I in g)if(I!=="default"&&!(I in c)){const e=Object.getOwnPropertyDescriptor(g,I);e&&Object.defineProperty(c,I,e.get?e:{enumerable:!0,get:()=>g[I]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}var y={},j={},G={},Z={},M={},X;function xe(){if(X)return M;X=1,Object.defineProperty(M,"__esModule",{value:!0});const c=Oe,E={INVALID_ENCODING:"Invalid encoding provided. Please specify a valid encoding the internal Node.js Buffer supports.",INVALID_SMARTBUFFER_SIZE:"Invalid size provided. Size must be a valid integer greater than zero.",INVALID_SMARTBUFFER_BUFFER:"Invalid Buffer provided in SmartBufferOptions.",INVALID_SMARTBUFFER_OBJECT:"Invalid SmartBufferOptions object supplied to SmartBuffer constructor or factory methods.",INVALID_OFFSET:"An invalid offset value was provided.",INVALID_OFFSET_NON_NUMBER:"An invalid offset value was provided. A numeric value is required.",INVALID_LENGTH:"An invalid length value was provided.",INVALID_LENGTH_NON_NUMBER:"An invalid length value was provived. A numeric value is required.",INVALID_TARGET_OFFSET:"Target offset is beyond the bounds of the internal SmartBuffer data.",INVALID_TARGET_LENGTH:"Specified length value moves cursor beyong the bounds of the internal SmartBuffer data.",INVALID_READ_BEYOND_BOUNDS:"Attempted to read beyond the bounds of the managed data.",INVALID_WRITE_BEYOND_BOUNDS:"Attempted to write beyond the bounds of the managed data."};M.ERRORS=E;function m(l){if(!c.Buffer.isEncoding(l))throw new Error(E.INVALID_ENCODING)}M.checkEncoding=m;function g(l){return typeof l=="number"&&isFinite(l)&&s(l)}M.isFiniteInteger=g;function I(l,B){if(typeof l=="number"){if(!g(l)||l<0)throw new Error(B?E.INVALID_OFFSET:E.INVALID_LENGTH)}else throw new Error(B?E.INVALID_OFFSET_NON_NUMBER:E.INVALID_LENGTH_NON_NUMBER)}function e(l){I(l,!1)}M.checkLengthValue=e;function t(l){I(l,!0)}M.checkOffsetValue=t;function a(l,B){if(l<0||l>B.length)throw new Error(E.INVALID_TARGET_OFFSET)}M.checkTargetOffset=a;function s(l){return typeof l=="number"&&isFinite(l)&&Math.floor(l)===l}function o(l){if(typeof BigInt>"u")throw new Error("Platform does not support JS BigInt type.");if(typeof c.Buffer.prototype[l]>"u")throw new Error(`Platform does not support Buffer.prototype.${l}.`)}return M.bigIntAndBufferInt64Check=o,M}var Q;function Me(){if(Q)return Z;Q=1,Object.defineProperty(Z,"__esModule",{value:!0});const c=xe(),E=4096,m="utf8";class g{constructor(e){if(this.length=0,this._encoding=m,this._writeOffset=0,this._readOffset=0,g.isSmartBufferOptions(e))if(e.encoding&&(c.checkEncoding(e.encoding),this._encoding=e.encoding),e.size)if(c.isFiniteInteger(e.size)&&e.size>0)this._buff=Buffer.allocUnsafe(e.size);else throw new Error(c.ERRORS.INVALID_SMARTBUFFER_SIZE);else if(e.buff)if(Buffer.isBuffer(e.buff))this._buff=e.buff,this.length=e.buff.length;else throw new Error(c.ERRORS.INVALID_SMARTBUFFER_BUFFER);else this._buff=Buffer.allocUnsafe(E);else{if(typeof e<"u")throw new Error(c.ERRORS.INVALID_SMARTBUFFER_OBJECT);this._buff=Buffer.allocUnsafe(E)}}static fromSize(e,t){return new this({size:e,encoding:t})}static fromBuffer(e,t){return new this({buff:e,encoding:t})}static fromOptions(e){return new this(e)}static isSmartBufferOptions(e){const t=e;return t&&(t.encoding!==void 0||t.size!==void 0||t.buff!==void 0)}readInt8(e){return this._readNumberValue(Buffer.prototype.readInt8,1,e)}readInt16BE(e){return this._readNumberValue(Buffer.prototype.readInt16BE,2,e)}readInt16LE(e){return this._readNumberValue(Buffer.prototype.readInt16LE,2,e)}readInt32BE(e){return this._readNumberValue(Buffer.prototype.readInt32BE,4,e)}readInt32LE(e){return this._readNumberValue(Buffer.prototype.readInt32LE,4,e)}readBigInt64BE(e){return c.bigIntAndBufferInt64Check("readBigInt64BE"),this._readNumberValue(Buffer.prototype.readBigInt64BE,8,e)}readBigInt64LE(e){return c.bigIntAndBufferInt64Check("readBigInt64LE"),this._readNumberValue(Buffer.prototype.readBigInt64LE,8,e)}writeInt8(e,t){return this._writeNumberValue(Buffer.prototype.writeInt8,1,e,t),this}insertInt8(e,t){return this._insertNumberValue(Buffer.prototype.writeInt8,1,e,t)}writeInt16BE(e,t){return this._writeNumberValue(Buffer.prototype.writeInt16BE,2,e,t)}insertInt16BE(e,t){return this._insertNumberValue(Buffer.prototype.writeInt16BE,2,e,t)}writeInt16LE(e,t){return this._writeNumberValue(Buffer.prototype.writeInt16LE,2,e,t)}insertInt16LE(e,t){return this._insertNumberValue(Buffer.prototype.writeInt16LE,2,e,t)}writeInt32BE(e,t){return this._writeNumberValue(Buffer.prototype.writeInt32BE,4,e,t)}insertInt32BE(e,t){return this._insertNumberValue(Buffer.prototype.writeInt32BE,4,e,t)}writeInt32LE(e,t){return this._writeNumberValue(Buffer.prototype.writeInt32LE,4,e,t)}insertInt32LE(e,t){return this._insertNumberValue(Buffer.prototype.writeInt32LE,4,e,t)}writeBigInt64BE(e,t){return c.bigIntAndBufferInt64Check("writeBigInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigInt64BE,8,e,t)}insertBigInt64BE(e,t){return c.bigIntAndBufferInt64Check("writeBigInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigInt64BE,8,e,t)}writeBigInt64LE(e,t){return c.bigIntAndBufferInt64Check("writeBigInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigInt64LE,8,e,t)}insertBigInt64LE(e,t){return c.bigIntAndBufferInt64Check("writeBigInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigInt64LE,8,e,t)}readUInt8(e){return this._readNumberValue(Buffer.prototype.readUInt8,1,e)}readUInt16BE(e){return this._readNumberValue(Buffer.prototype.readUInt16BE,2,e)}readUInt16LE(e){return this._readNumberValue(Buffer.prototype.readUInt16LE,2,e)}readUInt32BE(e){return this._readNumberValue(Buffer.prototype.readUInt32BE,4,e)}readUInt32LE(e){return this._readNumberValue(Buffer.prototype.readUInt32LE,4,e)}readBigUInt64BE(e){return c.bigIntAndBufferInt64Check("readBigUInt64BE"),this._readNumberValue(Buffer.prototype.readBigUInt64BE,8,e)}readBigUInt64LE(e){return c.bigIntAndBufferInt64Check("readBigUInt64LE"),this._readNumberValue(Buffer.prototype.readBigUInt64LE,8,e)}writeUInt8(e,t){return this._writeNumberValue(Buffer.prototype.writeUInt8,1,e,t)}insertUInt8(e,t){return this._insertNumberValue(Buffer.prototype.writeUInt8,1,e,t)}writeUInt16BE(e,t){return this._writeNumberValue(Buffer.prototype.writeUInt16BE,2,e,t)}insertUInt16BE(e,t){return this._insertNumberValue(Buffer.prototype.writeUInt16BE,2,e,t)}writeUInt16LE(e,t){return this._writeNumberValue(Buffer.prototype.writeUInt16LE,2,e,t)}insertUInt16LE(e,t){return this._insertNumberValue(Buffer.prototype.writeUInt16LE,2,e,t)}writeUInt32BE(e,t){return this._writeNumberValue(Buffer.prototype.writeUInt32BE,4,e,t)}insertUInt32BE(e,t){return this._insertNumberValue(Buffer.prototype.writeUInt32BE,4,e,t)}writeUInt32LE(e,t){return this._writeNumberValue(Buffer.prototype.writeUInt32LE,4,e,t)}insertUInt32LE(e,t){return this._insertNumberValue(Buffer.prototype.writeUInt32LE,4,e,t)}writeBigUInt64BE(e,t){return c.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64BE,8,e,t)}insertBigUInt64BE(e,t){return c.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64BE,8,e,t)}writeBigUInt64LE(e,t){return c.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64LE,8,e,t)}insertBigUInt64LE(e,t){return c.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64LE,8,e,t)}readFloatBE(e){return this._readNumberValue(Buffer.prototype.readFloatBE,4,e)}readFloatLE(e){return this._readNumberValue(Buffer.prototype.readFloatLE,4,e)}writeFloatBE(e,t){return this._writeNumberValue(Buffer.prototype.writeFloatBE,4,e,t)}insertFloatBE(e,t){return this._insertNumberValue(Buffer.prototype.writeFloatBE,4,e,t)}writeFloatLE(e,t){return this._writeNumberValue(Buffer.prototype.writeFloatLE,4,e,t)}insertFloatLE(e,t){return this._insertNumberValue(Buffer.prototype.writeFloatLE,4,e,t)}readDoubleBE(e){return this._readNumberValue(Buffer.prototype.readDoubleBE,8,e)}readDoubleLE(e){return this._readNumberValue(Buffer.prototype.readDoubleLE,8,e)}writeDoubleBE(e,t){return this._writeNumberValue(Buffer.prototype.writeDoubleBE,8,e,t)}insertDoubleBE(e,t){return this._insertNumberValue(Buffer.prototype.writeDoubleBE,8,e,t)}writeDoubleLE(e,t){return this._writeNumberValue(Buffer.prototype.writeDoubleLE,8,e,t)}insertDoubleLE(e,t){return this._insertNumberValue(Buffer.prototype.writeDoubleLE,8,e,t)}readString(e,t){let a;typeof e=="number"?(c.checkLengthValue(e),a=Math.min(e,this.length-this._readOffset)):(t=e,a=this.length-this._readOffset),typeof t<"u"&&c.checkEncoding(t);const s=this._buff.slice(this._readOffset,this._readOffset+a).toString(t||this._encoding);return this._readOffset+=a,s}insertString(e,t,a){return c.checkOffsetValue(t),this._handleString(e,!0,t,a)}writeString(e,t,a){return this._handleString(e,!1,t,a)}readStringNT(e){typeof e<"u"&&c.checkEncoding(e);let t=this.length;for(let s=this._readOffset;s<this.length;s++)if(this._buff[s]===0){t=s;break}const a=this._buff.slice(this._readOffset,t);return this._readOffset=t+1,a.toString(e||this._encoding)}insertStringNT(e,t,a){return c.checkOffsetValue(t),this.insertString(e,t,a),this.insertUInt8(0,t+e.length),this}writeStringNT(e,t,a){return this.writeString(e,t,a),this.writeUInt8(0,typeof t=="number"?t+e.length:this.writeOffset),this}readBuffer(e){typeof e<"u"&&c.checkLengthValue(e);const t=typeof e=="number"?e:this.length,a=Math.min(this.length,this._readOffset+t),s=this._buff.slice(this._readOffset,a);return this._readOffset=a,s}insertBuffer(e,t){return c.checkOffsetValue(t),this._handleBuffer(e,!0,t)}writeBuffer(e,t){return this._handleBuffer(e,!1,t)}readBufferNT(){let e=this.length;for(let a=this._readOffset;a<this.length;a++)if(this._buff[a]===0){e=a;break}const t=this._buff.slice(this._readOffset,e);return this._readOffset=e+1,t}insertBufferNT(e,t){return c.checkOffsetValue(t),this.insertBuffer(e,t),this.insertUInt8(0,t+e.length),this}writeBufferNT(e,t){return typeof t<"u"&&c.checkOffsetValue(t),this.writeBuffer(e,t),this.writeUInt8(0,typeof t=="number"?t+e.length:this._writeOffset),this}clear(){return this._writeOffset=0,this._readOffset=0,this.length=0,this}remaining(){return this.length-this._readOffset}get readOffset(){return this._readOffset}set readOffset(e){c.checkOffsetValue(e),c.checkTargetOffset(e,this),this._readOffset=e}get writeOffset(){return this._writeOffset}set writeOffset(e){c.checkOffsetValue(e),c.checkTargetOffset(e,this),this._writeOffset=e}get encoding(){return this._encoding}set encoding(e){c.checkEncoding(e),this._encoding=e}get internalBuffer(){return this._buff}toBuffer(){return this._buff.slice(0,this.length)}toString(e){const t=typeof e=="string"?e:this._encoding;return c.checkEncoding(t),this._buff.toString(t,0,this.length)}destroy(){return this.clear(),this}_handleString(e,t,a,s){let o=this._writeOffset,l=this._encoding;typeof a=="number"?o=a:typeof a=="string"&&(c.checkEncoding(a),l=a),typeof s=="string"&&(c.checkEncoding(s),l=s);const B=Buffer.byteLength(e,l);return t?this.ensureInsertable(B,o):this._ensureWriteable(B,o),this._buff.write(e,o,B,l),t?this._writeOffset+=B:typeof a=="number"?this._writeOffset=Math.max(this._writeOffset,o+B):this._writeOffset+=B,this}_handleBuffer(e,t,a){const s=typeof a=="number"?a:this._writeOffset;return t?this.ensureInsertable(e.length,s):this._ensureWriteable(e.length,s),e.copy(this._buff,s),t?this._writeOffset+=e.length:typeof a=="number"?this._writeOffset=Math.max(this._writeOffset,s+e.length):this._writeOffset+=e.length,this}ensureReadable(e,t){let a=this._readOffset;if(typeof t<"u"&&(c.checkOffsetValue(t),a=t),a<0||a+e>this.length)throw new Error(c.ERRORS.INVALID_READ_BEYOND_BOUNDS)}ensureInsertable(e,t){c.checkOffsetValue(t),this._ensureCapacity(this.length+e),t<this.length&&this._buff.copy(this._buff,t+e,t,this._buff.length),t+e>this.length?this.length=t+e:this.length+=e}_ensureWriteable(e,t){const a=typeof t=="number"?t:this._writeOffset;this._ensureCapacity(a+e),a+e>this.length&&(this.length=a+e)}_ensureCapacity(e){const t=this._buff.length;if(e>t){let a=this._buff,s=t*3/2+1;s<e&&(s=e),this._buff=Buffer.allocUnsafe(s),a.copy(this._buff,0,0,t)}}_readNumberValue(e,t,a){this.ensureReadable(t,a);const s=e.call(this._buff,typeof a=="number"?a:this._readOffset);return typeof a>"u"&&(this._readOffset+=t),s}_insertNumberValue(e,t,a,s){return c.checkOffsetValue(s),this.ensureInsertable(t,s),e.call(this._buff,a,s),this._writeOffset+=t,this}_writeNumberValue(e,t,a,s){if(typeof s=="number"){if(s<0)throw new Error(c.ERRORS.INVALID_WRITE_BEYOND_BOUNDS);c.checkOffsetValue(s)}const o=typeof s=="number"?s:this._writeOffset;return this._ensureWriteable(t,o),e.call(this._buff,a,o),typeof s=="number"?this._writeOffset=Math.max(this._writeOffset,o+t):this._writeOffset+=t,this}}return Z.SmartBuffer=g,Z}var k={},ee;function _e(){if(ee)return k;ee=1,Object.defineProperty(k,"__esModule",{value:!0}),k.SOCKS5_NO_ACCEPTABLE_AUTH=k.SOCKS5_CUSTOM_AUTH_END=k.SOCKS5_CUSTOM_AUTH_START=k.SOCKS_INCOMING_PACKET_SIZES=k.SocksClientState=k.Socks5Response=k.Socks5HostType=k.Socks5Auth=k.Socks4Response=k.SocksCommand=k.ERRORS=k.DEFAULT_TIMEOUT=void 0;const c=3e4;k.DEFAULT_TIMEOUT=c;const E={InvalidSocksCommand:"An invalid SOCKS command was provided. Valid options are connect, bind, and associate.",InvalidSocksCommandForOperation:"An invalid SOCKS command was provided. Only a subset of commands are supported for this operation.",InvalidSocksCommandChain:"An invalid SOCKS command was provided. Chaining currently only supports the connect command.",InvalidSocksClientOptionsDestination:"An invalid destination host was provided.",InvalidSocksClientOptionsExistingSocket:"An invalid existing socket was provided. This should be an instance of stream.Duplex.",InvalidSocksClientOptionsProxy:"Invalid SOCKS proxy details were provided.",InvalidSocksClientOptionsTimeout:"An invalid timeout value was provided. Please enter a value above 0 (in ms).",InvalidSocksClientOptionsProxiesLength:"At least two socks proxies must be provided for chaining.",InvalidSocksClientOptionsCustomAuthRange:"Custom auth must be a value between 0x80 and 0xFE.",InvalidSocksClientOptionsCustomAuthOptions:"When a custom_auth_method is provided, custom_auth_request_handler, custom_auth_response_size, and custom_auth_response_handler must also be provided and valid.",NegotiationError:"Negotiation error",SocketClosed:"Socket closed",ProxyConnectionTimedOut:"Proxy connection timed out",InternalError:"SocksClient internal error (this should not happen)",InvalidSocks4HandshakeResponse:"Received invalid Socks4 handshake response",Socks4ProxyRejectedConnection:"Socks4 Proxy rejected connection",InvalidSocks4IncomingConnectionResponse:"Socks4 invalid incoming connection response",Socks4ProxyRejectedIncomingBoundConnection:"Socks4 Proxy rejected incoming bound connection",InvalidSocks5InitialHandshakeResponse:"Received invalid Socks5 initial handshake response",InvalidSocks5IntiailHandshakeSocksVersion:"Received invalid Socks5 initial handshake (invalid socks version)",InvalidSocks5InitialHandshakeNoAcceptedAuthType:"Received invalid Socks5 initial handshake (no accepted authentication type)",InvalidSocks5InitialHandshakeUnknownAuthType:"Received invalid Socks5 initial handshake (unknown authentication type)",Socks5AuthenticationFailed:"Socks5 Authentication failed",InvalidSocks5FinalHandshake:"Received invalid Socks5 final handshake response",InvalidSocks5FinalHandshakeRejected:"Socks5 proxy rejected connection",InvalidSocks5IncomingConnectionResponse:"Received invalid Socks5 incoming connection response",Socks5ProxyRejectedIncomingBoundConnection:"Socks5 Proxy rejected incoming bound connection"};k.ERRORS=E;const m={Socks5InitialHandshakeResponse:2,Socks5UserPassAuthenticationResponse:2,Socks5ResponseHeader:5,Socks5ResponseIPv4:10,Socks5ResponseIPv6:22,Socks5ResponseHostname:r=>r+7,Socks4Response:8};k.SOCKS_INCOMING_PACKET_SIZES=m;var g;(function(r){r[r.connect=1]="connect",r[r.bind=2]="bind",r[r.associate=3]="associate"})(g||(k.SocksCommand=g={}));var I;(function(r){r[r.Granted=90]="Granted",r[r.Failed=91]="Failed",r[r.Rejected=92]="Rejected",r[r.RejectedIdent=93]="RejectedIdent"})(I||(k.Socks4Response=I={}));var e;(function(r){r[r.NoAuth=0]="NoAuth",r[r.GSSApi=1]="GSSApi",r[r.UserPass=2]="UserPass"})(e||(k.Socks5Auth=e={}));const t=128;k.SOCKS5_CUSTOM_AUTH_START=t;const a=254;k.SOCKS5_CUSTOM_AUTH_END=a;const s=255;k.SOCKS5_NO_ACCEPTABLE_AUTH=s;var o;(function(r){r[r.Granted=0]="Granted",r[r.Failure=1]="Failure",r[r.NotAllowed=2]="NotAllowed",r[r.NetworkUnreachable=3]="NetworkUnreachable",r[r.HostUnreachable=4]="HostUnreachable",r[r.ConnectionRefused=5]="ConnectionRefused",r[r.TTLExpired=6]="TTLExpired",r[r.CommandNotSupported=7]="CommandNotSupported",r[r.AddressNotSupported=8]="AddressNotSupported"})(o||(k.Socks5Response=o={}));var l;(function(r){r[r.IPv4=1]="IPv4",r[r.Hostname=3]="Hostname",r[r.IPv6=4]="IPv6"})(l||(k.Socks5HostType=l={}));var B;return(function(r){r[r.Created=0]="Created",r[r.Connecting=1]="Connecting",r[r.Connected=2]="Connected",r[r.SentInitialHandshake=3]="SentInitialHandshake",r[r.ReceivedInitialHandshakeResponse=4]="ReceivedInitialHandshakeResponse",r[r.SentAuthentication=5]="SentAuthentication",r[r.ReceivedAuthenticationResponse=6]="ReceivedAuthenticationResponse",r[r.SentFinalHandshake=7]="SentFinalHandshake",r[r.ReceivedFinalResponse=8]="ReceivedFinalResponse",r[r.BoundWaitingForConnection=9]="BoundWaitingForConnection",r[r.Established=10]="Established",r[r.Disconnected=11]="Disconnected",r[r.Error=99]="Error"})(B||(k.SocksClientState=B={})),k}var C={},F={},te;function Ie(){if(te)return F;te=1,Object.defineProperty(F,"__esModule",{value:!0}),F.shuffleArray=F.SocksClientError=void 0;class c extends Error{constructor(g,I){super(g),this.options=I}}F.SocksClientError=c;function E(m){for(let g=m.length-1;g>0;g--){const I=Math.floor(Math.random()*(g+1));[m[g],m[I]]=[m[I],m[g]]}}return F.shuffleArray=E,F}var D={},T={},L={},re;function W(){if(re)return L;re=1,Object.defineProperty(L,"__esModule",{value:!0}),L.isInSubnet=c,L.isCorrect=E,L.numberToPaddedHex=m,L.stringToPaddedHex=g,L.testBit=I;function c(e){return this.subnetMask<e.subnetMask?!1:this.mask(e.subnetMask)===e.mask()}function E(e){return function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===e&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)}}function m(e){return e.toString(16).padStart(2,"0")}function g(e){return m(parseInt(e,10))}function I(e,t){const{length:a}=e;if(t>a)return!1;const s=a-t;return e.substring(s,s+1)==="1"}return L}var N={},se;function ge(){return se||(se=1,Object.defineProperty(N,"__esModule",{value:!0}),N.RE_SUBNET_STRING=N.RE_ADDRESS=N.GROUPS=N.BITS=void 0,N.BITS=32,N.GROUPS=4,N.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,N.RE_SUBNET_STRING=/\/\d{1,2}$/),N}var q={},ne;function J(){if(ne)return q;ne=1,Object.defineProperty(q,"__esModule",{value:!0}),q.AddressError=void 0;class c extends Error{constructor(m,g){super(m),this.name="AddressError",this.parseMessage=g}}return q.AddressError=c,q}var ie;function me(){if(ie)return T;ie=1;var c=T&&T.__createBinding||(Object.create?(function(a,s,o,l){l===void 0&&(l=o);var B=Object.getOwnPropertyDescriptor(s,o);(!B||("get"in B?!s.__esModule:B.writable||B.configurable))&&(B={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(a,l,B)}):(function(a,s,o,l){l===void 0&&(l=o),a[l]=s[o]})),E=T&&T.__setModuleDefault||(Object.create?(function(a,s){Object.defineProperty(a,"default",{enumerable:!0,value:s})}):function(a,s){a.default=s}),m=T&&T.__importStar||function(a){if(a&&a.__esModule)return a;var s={};if(a!=null)for(var o in a)o!=="default"&&Object.prototype.hasOwnProperty.call(a,o)&&c(s,a,o);return E(s,a),s};Object.defineProperty(T,"__esModule",{value:!0}),T.Address4=void 0;const g=m(W()),I=m(ge()),e=J();class t{constructor(s){this.groups=I.GROUPS,this.parsedAddress=[],this.parsedSubnet="",this.subnet="/32",this.subnetMask=32,this.v4=!0,this.isCorrect=g.isCorrect(I.BITS),this.isInSubnet=g.isInSubnet,this.address=s;const o=I.RE_SUBNET_STRING.exec(s);if(o){if(this.parsedSubnet=o[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,this.subnetMask<0||this.subnetMask>I.BITS)throw new e.AddressError("Invalid subnet mask.");s=s.replace(I.RE_SUBNET_STRING,"")}this.addressMinusSuffix=s,this.parsedAddress=this.parse(s)}static isValid(s){try{return new t(s),!0}catch{return!1}}parse(s){const o=s.split(".");if(!s.match(I.RE_ADDRESS))throw new e.AddressError("Invalid IPv4 address.");return o}correctForm(){return this.parsedAddress.map(s=>parseInt(s,10)).join(".")}static fromHex(s){const o=s.replace(/:/g,"").padStart(8,"0"),l=[];let B;for(B=0;B<8;B+=2){const r=o.slice(B,B+2);l.push(parseInt(r,16))}return new t(l.join("."))}static fromInteger(s){return t.fromHex(s.toString(16))}static fromArpa(s){const l=s.replace(/(\.in-addr\.arpa)?\.$/,"").split(".").reverse().join(".");return new t(l)}toHex(){return this.parsedAddress.map(s=>g.stringToPaddedHex(s)).join(":")}toArray(){return this.parsedAddress.map(s=>parseInt(s,10))}toGroup6(){const s=[];let o;for(o=0;o<I.GROUPS;o+=2)s.push(`${g.stringToPaddedHex(this.parsedAddress[o])}${g.stringToPaddedHex(this.parsedAddress[o+1])}`);return s.join(":")}bigInt(){return BigInt(`0x${this.parsedAddress.map(s=>g.stringToPaddedHex(s)).join("")}`)}_startAddress(){return BigInt(`0b${this.mask()+"0".repeat(I.BITS-this.subnetMask)}`)}startAddress(){return t.fromBigInt(this._startAddress())}startAddressExclusive(){const s=BigInt("1");return t.fromBigInt(this._startAddress()+s)}_endAddress(){return BigInt(`0b${this.mask()+"1".repeat(I.BITS-this.subnetMask)}`)}endAddress(){return t.fromBigInt(this._endAddress())}endAddressExclusive(){const s=BigInt("1");return t.fromBigInt(this._endAddress()-s)}static fromBigInt(s){return t.fromHex(s.toString(16))}static fromByteArray(s){if(s.length!==4)throw new e.AddressError("IPv4 addresses require exactly 4 bytes");for(let o=0;o<s.length;o++)if(!Number.isInteger(s[o])||s[o]<0||s[o]>255)throw new e.AddressError("All bytes must be integers between 0 and 255");return this.fromUnsignedByteArray(s)}static fromUnsignedByteArray(s){if(s.length!==4)throw new e.AddressError("IPv4 addresses require exactly 4 bytes");const o=s.join(".");return new t(o)}mask(s){return s===void 0&&(s=this.subnetMask),this.getBitsBase2(0,s)}getBitsBase2(s,o){return this.binaryZeroPad().slice(s,o)}reverseForm(s){s||(s={});const o=this.correctForm().split(".").reverse().join(".");return s.omitSuffix?o:`${o}.in-addr.arpa.`}isMulticast(){return this.isInSubnet(new t("224.0.0.0/4"))}binaryZeroPad(){return this.bigInt().toString(2).padStart(I.BITS,"0")}groupForV6(){const s=this.parsedAddress;return this.address.replace(I.RE_ADDRESS,`<span class="hover-group group-v4 group-6">${s.slice(0,2).join(".")}</span>.<span class="hover-group group-v4 group-7">${s.slice(2,4).join(".")}</span>`)}}return T.Address4=t,T}var U={},O={},oe;function Be(){return oe||(oe=1,Object.defineProperty(O,"__esModule",{value:!0}),O.RE_URL_WITH_PORT=O.RE_URL=O.RE_ZONE_STRING=O.RE_SUBNET_STRING=O.RE_BAD_ADDRESS=O.RE_BAD_CHARACTERS=O.TYPES=O.SCOPES=O.GROUPS=O.BITS=void 0,O.BITS=128,O.GROUPS=8,O.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},O.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},O.RE_BAD_CHARACTERS=/([^0-9a-f:/%])/gi,O.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/gi,O.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/,O.RE_ZONE_STRING=/%.*$/,O.RE_URL=/^\[{0,1}([0-9a-f:]+)\]{0,1}/,O.RE_URL_WITH_PORT=/\[([0-9a-f:]+)\]:([0-9]{1,5})/),O}var V={},ae;function Ee(){if(ae)return V;ae=1,Object.defineProperty(V,"__esModule",{value:!0}),V.spanAllZeroes=c,V.spanAll=E,V.spanLeadingZeroes=g,V.simpleGroup=I;function c(e){return e.replace(/(0+)/g,'<span class="zero">$1</span>')}function E(e,t=0){return e.split("").map((s,o)=>`<span class="digit value-${s} position-${o+t}">${c(s)}</span>`).join("")}function m(e){return e.replace(/^(0+)/,'<span class="zero">$1</span>')}function g(e){return e.split(":").map(a=>m(a)).join(":")}function I(e,t=0){return e.split(":").map((s,o)=>/group-v4/.test(s)?s:`<span class="hover-group group-${o+t}">${m(s)}</span>`)}return V}var A={},ue;function De(){if(ue)return A;ue=1;var c=A&&A.__createBinding||(Object.create?(function(s,o,l,B){B===void 0&&(B=l);var r=Object.getOwnPropertyDescriptor(o,l);(!r||("get"in r?!o.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return o[l]}}),Object.defineProperty(s,B,r)}):(function(s,o,l,B){B===void 0&&(B=l),s[B]=o[l]})),E=A&&A.__setModuleDefault||(Object.create?(function(s,o){Object.defineProperty(s,"default",{enumerable:!0,value:o})}):function(s,o){s.default=o}),m=A&&A.__importStar||function(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var l in s)l!=="default"&&Object.prototype.hasOwnProperty.call(s,l)&&c(o,s,l);return E(o,s),o};Object.defineProperty(A,"__esModule",{value:!0}),A.ADDRESS_BOUNDARY=void 0,A.groupPossibilities=I,A.padGroup=e,A.simpleRegularExpression=t,A.possibleElisions=a;const g=m(Be());function I(s){return`(${s.join("|")})`}function e(s){return s.length<4?`0{0,${4-s.length}}${s}`:s}A.ADDRESS_BOUNDARY="[^A-Fa-f0-9:]";function t(s){const o=[];s.forEach((B,r)=>{parseInt(B,16)===0&&o.push(r)});const l=o.map(B=>s.map((r,d)=>{if(d===B){const i=d===0||d===g.GROUPS-1?":":"";return I([e(r),i])}return e(r)}).join(":"));return l.push(s.map(e).join(":")),I(l)}function a(s,o,l){const B=o?"":":",r=l?"":":",d=[];!o&&!l&&d.push("::"),o&&l&&d.push(""),(l&&!o||!l&&o)&&d.push(":"),d.push(`${B}(:0{1,4}){1,${s-1}}`),d.push(`(0{1,4}:){1,${s-1}}${r}`),d.push(`(0{1,4}:){${s-1}}0{1,4}`);for(let i=1;i<s-1;i++)for(let b=1;b<s-i;b++)d.push(`(0{1,4}:){${b}}:(0{1,4}:){${s-b-i-1}}0{1,4}`);return I(d)}return A}var fe;function He(){if(fe)return U;fe=1;var c=U&&U.__createBinding||(Object.create?(function(_,n,f,h){h===void 0&&(h=f);var p=Object.getOwnPropertyDescriptor(n,f);(!p||("get"in p?!n.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return n[f]}}),Object.defineProperty(_,h,p)}):(function(_,n,f,h){h===void 0&&(h=f),_[h]=n[f]})),E=U&&U.__setModuleDefault||(Object.create?(function(_,n){Object.defineProperty(_,"default",{enumerable:!0,value:n})}):function(_,n){_.default=n}),m=U&&U.__importStar||function(_){if(_&&_.__esModule)return _;var n={};if(_!=null)for(var f in _)f!=="default"&&Object.prototype.hasOwnProperty.call(_,f)&&c(n,_,f);return E(n,_),n};Object.defineProperty(U,"__esModule",{value:!0}),U.Address6=void 0;const g=m(W()),I=m(ge()),e=m(Be()),t=m(Ee()),a=me(),s=De(),o=J(),l=W();function B(_){if(!_)throw new Error("Assertion failed.")}function r(_){const n=/(\d+)(\d{3})/;for(;n.test(_);)_=_.replace(n,"$1,$2");return _}function d(_){return _=_.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),_=_.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),_}function i(_,n){const f=[],h=[];let p;for(p=0;p<_.length;p++)p<n[0]?f.push(_[p]):p>n[1]&&h.push(_[p]);return f.concat(["compact"]).concat(h)}function b(_){return parseInt(_,16).toString(16).padStart(4,"0")}function u(_){return _&255}class S{constructor(n,f){this.addressMinusSuffix="",this.parsedSubnet="",this.subnet="/128",this.subnetMask=128,this.v4=!1,this.zone="",this.isInSubnet=g.isInSubnet,this.isCorrect=g.isCorrect(e.BITS),f===void 0?this.groups=e.GROUPS:this.groups=f,this.address=n;const h=e.RE_SUBNET_STRING.exec(n);if(h){if(this.parsedSubnet=h[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,Number.isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>e.BITS)throw new o.AddressError("Invalid subnet mask.");n=n.replace(e.RE_SUBNET_STRING,"")}else if(/\//.test(n))throw new o.AddressError("Invalid subnet mask.");const p=e.RE_ZONE_STRING.exec(n);p&&(this.zone=p[0],n=n.replace(e.RE_ZONE_STRING,"")),this.addressMinusSuffix=n,this.parsedAddress=this.parse(this.addressMinusSuffix)}static isValid(n){try{return new S(n),!0}catch{return!1}}static fromBigInt(n){const f=n.toString(16).padStart(32,"0"),h=[];let p;for(p=0;p<e.GROUPS;p++)h.push(f.slice(p*4,(p+1)*4));return new S(h.join(":"))}static fromURL(n){let f,h=null,p;if(n.indexOf("[")!==-1&&n.indexOf("]:")!==-1){if(p=e.RE_URL_WITH_PORT.exec(n),p===null)return{error:"failed to parse address with port",address:null,port:null};f=p[1],h=p[2]}else if(n.indexOf("/")!==-1){if(n=n.replace(/^[a-z0-9]+:\/\//,""),p=e.RE_URL.exec(n),p===null)return{error:"failed to parse address from URL",address:null,port:null};f=p[1]}else f=n;return h?(h=parseInt(h,10),(h<0||h>65536)&&(h=null)):h=null,{address:new S(f),port:h}}static fromAddress4(n){const f=new a.Address4(n),h=e.BITS-(I.BITS-f.subnetMask);return new S(`::ffff:${f.correctForm()}/${h}`)}static fromArpa(n){let f=n.replace(/(\.ip6\.arpa)?\.$/,"");const h=7;if(f.length!==63)throw new o.AddressError("Invalid 'ip6.arpa' form.");const p=f.split(".").reverse();for(let v=h;v>0;v--){const R=v*4;p.splice(R,0,":")}return f=p.join(""),new S(f)}microsoftTranscription(){return`${this.correctForm().replace(/:/g,"-")}.ipv6-literal.net`}mask(n=this.subnetMask){return this.getBitsBase2(0,n)}possibleSubnets(n=128){const f=e.BITS-this.subnetMask,h=Math.abs(n-e.BITS),p=f-h;return p<0?"0":r((BigInt("2")**BigInt(p)).toString(10))}_startAddress(){return BigInt(`0b${this.mask()+"0".repeat(e.BITS-this.subnetMask)}`)}startAddress(){return S.fromBigInt(this._startAddress())}startAddressExclusive(){const n=BigInt("1");return S.fromBigInt(this._startAddress()+n)}_endAddress(){return BigInt(`0b${this.mask()+"1".repeat(e.BITS-this.subnetMask)}`)}endAddress(){return S.fromBigInt(this._endAddress())}endAddressExclusive(){const n=BigInt("1");return S.fromBigInt(this._endAddress()-n)}getScope(){let n=e.SCOPES[parseInt(this.getBits(12,16).toString(10),10)];return this.getType()==="Global unicast"&&n!=="Link local"&&(n="Global"),n||"Unknown"}getType(){for(const n of Object.keys(e.TYPES))if(this.isInSubnet(new S(n)))return e.TYPES[n];return"Global unicast"}getBits(n,f){return BigInt(`0b${this.getBitsBase2(n,f)}`)}getBitsBase2(n,f){return this.binaryZeroPad().slice(n,f)}getBitsBase16(n,f){const h=f-n;if(h%4!==0)throw new Error("Length of bits to retrieve must be divisible by four");return this.getBits(n,f).toString(16).padStart(h/4,"0")}getBitsPastSubnet(){return this.getBitsBase2(this.subnetMask,e.BITS)}reverseForm(n){n||(n={});const f=Math.floor(this.subnetMask/4),h=this.canonicalForm().replace(/:/g,"").split("").slice(0,f).reverse().join(".");return f>0?n.omitSuffix?h:`${h}.ip6.arpa.`:n.omitSuffix?"":"ip6.arpa."}correctForm(){let n,f=[],h=0;const p=[];for(n=0;n<this.parsedAddress.length;n++){const w=parseInt(this.parsedAddress[n],16);w===0&&h++,w!==0&&h>0&&(h>1&&p.push([n-h,n-1]),h=0)}h>1&&p.push([this.parsedAddress.length-h,this.parsedAddress.length-1]);const v=p.map(w=>w[1]-w[0]+1);if(p.length>0){const w=v.indexOf(Math.max(...v));f=i(this.parsedAddress,p[w])}else f=this.parsedAddress;for(n=0;n<f.length;n++)f[n]!=="compact"&&(f[n]=parseInt(f[n],16).toString(16));let R=f.join(":");return R=R.replace(/^compact$/,"::"),R=R.replace(/(^compact)|(compact$)/,":"),R=R.replace(/compact/,""),R}binaryZeroPad(){return this.bigInt().toString(2).padStart(e.BITS,"0")}parse4in6(n){const f=n.split(":"),p=f.slice(-1)[0].match(I.RE_ADDRESS);if(p){this.parsedAddress4=p[0],this.address4=new a.Address4(this.parsedAddress4);for(let v=0;v<this.address4.groups;v++)if(/^0[0-9]+/.test(this.address4.parsedAddress[v]))throw new o.AddressError("IPv4 addresses can't have leading zeroes.",n.replace(I.RE_ADDRESS,this.address4.parsedAddress.map(d).join(".")));this.v4=!0,f[f.length-1]=this.address4.toGroup6(),n=f.join(":")}return n}parse(n){n=this.parse4in6(n);const f=n.match(e.RE_BAD_CHARACTERS);if(f)throw new o.AddressError(`Bad character${f.length>1?"s":""} detected in address: ${f.join("")}`,n.replace(e.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'));const h=n.match(e.RE_BAD_ADDRESS);if(h)throw new o.AddressError(`Address failed regex: ${h.join("")}`,n.replace(e.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'));let p=[];const v=n.split("::");if(v.length===2){let R=v[0].split(":"),w=v[1].split(":");R.length===1&&R[0]===""&&(R=[]),w.length===1&&w[0]===""&&(w=[]);const H=this.groups-(R.length+w.length);if(!H)throw new o.AddressError("Error parsing groups");this.elidedGroups=H,this.elisionBegin=R.length,this.elisionEnd=R.length+this.elidedGroups,p=p.concat(R);for(let P=0;P<H;P++)p.push("0");p=p.concat(w)}else if(v.length===1)p=n.split(":"),this.elidedGroups=0;else throw new o.AddressError("Too many :: groups found");if(p=p.map(R=>parseInt(R,16).toString(16)),p.length!==this.groups)throw new o.AddressError("Incorrect number of groups found");return p}canonicalForm(){return this.parsedAddress.map(b).join(":")}decimal(){return this.parsedAddress.map(n=>parseInt(n,16).toString(10).padStart(5,"0")).join(":")}bigInt(){return BigInt(`0x${this.parsedAddress.map(b).join("")}`)}to4(){const n=this.binaryZeroPad().split("");return a.Address4.fromHex(BigInt(`0b${n.slice(96,128).join("")}`).toString(16))}to4in6(){const n=this.to4(),h=new S(this.parsedAddress.slice(0,6).join(":"),6).correctForm();let p="";return/:$/.test(h)||(p=":"),h+p+n.address}inspectTeredo(){const n=this.getBitsBase16(0,32),h=(this.getBits(80,96)^BigInt("0xffff")).toString(),p=a.Address4.fromHex(this.getBitsBase16(32,64)),v=this.getBits(96,128),R=a.Address4.fromHex((v^BigInt("0xffffffff")).toString(16)),w=this.getBitsBase2(64,80),H=(0,l.testBit)(w,15),P=(0,l.testBit)(w,14),x=(0,l.testBit)(w,8),$=(0,l.testBit)(w,9),z=BigInt(`0b${w.slice(2,6)+w.slice(8,16)}`).toString(10);return{prefix:`${n.slice(0,4)}:${n.slice(4,8)}`,server4:p.address,client4:R.address,flags:w,coneNat:H,microsoft:{reserved:P,universalLocal:$,groupIndividual:x,nonce:z},udpPort:h}}inspect6to4(){const n=this.getBitsBase16(0,16),f=a.Address4.fromHex(this.getBitsBase16(16,48));return{prefix:n.slice(0,4),gateway:f.address}}to6to4(){if(!this.is4())return null;const n=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new S(n)}toByteArray(){const n=this.bigInt().toString(16),h=`${"0".repeat(n.length%2)}${n}`,p=[];for(let v=0,R=h.length;v<R;v+=2)p.push(parseInt(h.substring(v,v+2),16));return p}toUnsignedByteArray(){return this.toByteArray().map(u)}static fromByteArray(n){return this.fromUnsignedByteArray(n.map(u))}static fromUnsignedByteArray(n){const f=BigInt("256");let h=BigInt("0"),p=BigInt("1");for(let v=n.length-1;v>=0;v--)h+=p*BigInt(n[v].toString(10)),p*=f;return S.fromBigInt(h)}isCanonical(){return this.addressMinusSuffix===this.canonicalForm()}isLinkLocal(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}isMulticast(){return this.getType()==="Multicast"}is4(){return this.v4}isTeredo(){return this.isInSubnet(new S("2001::/32"))}is6to4(){return this.isInSubnet(new S("2002::/16"))}isLoopback(){return this.getType()==="Loopback"}href(n){return n===void 0?n="":n=`:${n}`,`http://[${this.correctForm()}]${n}/`}link(n){n||(n={}),n.className===void 0&&(n.className=""),n.prefix===void 0&&(n.prefix="/#address="),n.v4===void 0&&(n.v4=!1);let f=this.correctForm;n.v4&&(f=this.to4in6);const h=f.call(this);return n.className?`<a href="${n.prefix}${h}" class="${n.className}">${h}</a>`:`<a href="${n.prefix}${h}">${h}</a>`}group(){if(this.elidedGroups===0)return t.simpleGroup(this.address).join(":");B(typeof this.elidedGroups=="number"),B(typeof this.elisionBegin=="number");const n=[],[f,h]=this.address.split("::");f.length?n.push(...t.simpleGroup(f)):n.push("");const p=["hover-group"];for(let v=this.elisionBegin;v<this.elisionBegin+this.elidedGroups;v++)p.push(`group-${v}`);return n.push(`<span class="${p.join(" ")}"></span>`),h.length?n.push(...t.simpleGroup(h,this.elisionEnd)):n.push(""),this.is4()&&(B(this.address4 instanceof a.Address4),n.pop(),n.push(this.address4.groupForV6())),n.join(":")}regularExpressionString(n=!1){let f=[];const h=new S(this.correctForm());if(h.elidedGroups===0)f.push((0,s.simpleRegularExpression)(h.parsedAddress));else if(h.elidedGroups===e.GROUPS)f.push((0,s.possibleElisions)(e.GROUPS));else{const p=h.address.split("::");p[0].length&&f.push((0,s.simpleRegularExpression)(p[0].split(":"))),B(typeof h.elidedGroups=="number"),f.push((0,s.possibleElisions)(h.elidedGroups,p[0].length!==0,p[1].length!==0)),p[1].length&&f.push((0,s.simpleRegularExpression)(p[1].split(":"))),f=[f.join(":")]}return n||(f=["(?=^|",s.ADDRESS_BOUNDARY,"|[^\\w\\:])(",...f,")(?=[^\\w\\:]|",s.ADDRESS_BOUNDARY,"|$)"]),f.join("")}regularExpression(n=!1){return new RegExp(this.regularExpressionString(n),"i")}}return U.Address6=S,U}var ce;function be(){return ce||(ce=1,(function(c){var E=D&&D.__createBinding||(Object.create?(function(s,o,l,B){B===void 0&&(B=l);var r=Object.getOwnPropertyDescriptor(o,l);(!r||("get"in r?!o.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return o[l]}}),Object.defineProperty(s,B,r)}):(function(s,o,l,B){B===void 0&&(B=l),s[B]=o[l]})),m=D&&D.__setModuleDefault||(Object.create?(function(s,o){Object.defineProperty(s,"default",{enumerable:!0,value:o})}):function(s,o){s.default=o}),g=D&&D.__importStar||function(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var l in s)l!=="default"&&Object.prototype.hasOwnProperty.call(s,l)&&E(o,s,l);return m(o,s),o};Object.defineProperty(c,"__esModule",{value:!0}),c.v6=c.AddressError=c.Address6=c.Address4=void 0;var I=me();Object.defineProperty(c,"Address4",{enumerable:!0,get:function(){return I.Address4}});var e=He();Object.defineProperty(c,"Address6",{enumerable:!0,get:function(){return e.Address6}});var t=J();Object.defineProperty(c,"AddressError",{enumerable:!0,get:function(){return t.AddressError}});const a=g(Ee());c.v6={helpers:a}})(D)),D}var de;function Le(){if(de)return C;de=1,Object.defineProperty(C,"__esModule",{value:!0}),C.ipToBuffer=C.int32ToIpv4=C.ipv4ToInt32=C.validateSocksClientChainOptions=C.validateSocksClientOptions=void 0;const c=Ie(),E=_e(),m=Ae,g=be(),I=Y;function e(i,b=["connect","bind","associate"]){if(!E.SocksCommand[i.command])throw new c.SocksClientError(E.ERRORS.InvalidSocksCommand,i);if(b.indexOf(i.command)===-1)throw new c.SocksClientError(E.ERRORS.InvalidSocksCommandForOperation,i);if(!s(i.destination))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsDestination,i);if(!o(i.proxy))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsProxy,i);if(a(i.proxy,i),i.timeout&&!l(i.timeout))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsTimeout,i);if(i.existing_socket&&!(i.existing_socket instanceof m.Duplex))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsExistingSocket,i)}C.validateSocksClientOptions=e;function t(i){if(i.command!=="connect")throw new c.SocksClientError(E.ERRORS.InvalidSocksCommandChain,i);if(!s(i.destination))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsDestination,i);if(!(i.proxies&&Array.isArray(i.proxies)&&i.proxies.length>=2))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsProxiesLength,i);if(i.proxies.forEach(b=>{if(!o(b))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsProxy,i);a(b,i)}),i.timeout&&!l(i.timeout))throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsTimeout,i)}C.validateSocksClientChainOptions=t;function a(i,b){if(i.custom_auth_method!==void 0){if(i.custom_auth_method<E.SOCKS5_CUSTOM_AUTH_START||i.custom_auth_method>E.SOCKS5_CUSTOM_AUTH_END)throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsCustomAuthRange,b);if(i.custom_auth_request_handler===void 0||typeof i.custom_auth_request_handler!="function")throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,b);if(i.custom_auth_response_size===void 0)throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,b);if(i.custom_auth_response_handler===void 0||typeof i.custom_auth_response_handler!="function")throw new c.SocksClientError(E.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,b)}}function s(i){return i&&typeof i.host=="string"&&Buffer.byteLength(i.host)<256&&typeof i.port=="number"&&i.port>=0&&i.port<=65535}function o(i){return i&&(typeof i.host=="string"||typeof i.ipaddress=="string")&&typeof i.port=="number"&&i.port>=0&&i.port<=65535&&(i.type===4||i.type===5)}function l(i){return typeof i=="number"&&i>0}function B(i){return new g.Address4(i).toArray().reduce((u,S)=>(u<<8)+S,0)>>>0}C.ipv4ToInt32=B;function r(i){const b=i>>>24&255,u=i>>>16&255,S=i>>>8&255,_=i&255;return[b,u,S,_].join(".")}C.int32ToIpv4=r;function d(i){if(I.isIPv4(i)){const b=new g.Address4(i);return Buffer.from(b.toArray())}else if(I.isIPv6(i)){const b=new g.Address6(i);return Buffer.from(b.canonicalForm().split(":").map(u=>u.padStart(4,"0")).join(""),"hex")}else throw new Error("Invalid IP address format")}return C.ipToBuffer=d,C}var K={},he;function je(){if(he)return K;he=1,Object.defineProperty(K,"__esModule",{value:!0}),K.ReceiveBuffer=void 0;class c{constructor(m=4096){this.buffer=Buffer.allocUnsafe(m),this.offset=0,this.originalSize=m}get length(){return this.offset}append(m){if(!Buffer.isBuffer(m))throw new Error("Attempted to append a non-buffer instance to ReceiveBuffer.");if(this.offset+m.length>=this.buffer.length){const g=this.buffer;this.buffer=Buffer.allocUnsafe(Math.max(this.buffer.length+this.originalSize,this.buffer.length+m.length)),g.copy(this.buffer)}return m.copy(this.buffer,this.offset),this.offset+=m.length}peek(m){if(m>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");return this.buffer.slice(0,m)}get(m){if(m>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");const g=Buffer.allocUnsafe(m);return this.buffer.slice(0,m).copy(g),this.buffer.copyWithin(0,m,m+this.offset-m),this.offset-=m,g}}return K.ReceiveBuffer=c,K}var le;function Fe(){return le||(le=1,(function(c){var E=G&&G.__awaiter||function(B,r,d,i){function b(u){return u instanceof d?u:new d(function(S){S(u)})}return new(d||(d=Promise))(function(u,S){function _(h){try{f(i.next(h))}catch(p){S(p)}}function n(h){try{f(i.throw(h))}catch(p){S(p)}}function f(h){h.done?u(h.value):b(h.value).then(_,n)}f((i=i.apply(B,r||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.SocksClientError=c.SocksClient=void 0;const m=we,g=Y,I=Me(),e=_e(),t=Le(),a=je(),s=Ie();Object.defineProperty(c,"SocksClientError",{enumerable:!0,get:function(){return s.SocksClientError}});const o=be();class l extends m.EventEmitter{constructor(r){super(),this.options=Object.assign({},r),(0,t.validateSocksClientOptions)(r),this.setState(e.SocksClientState.Created)}static createConnection(r,d){return new Promise((i,b)=>{try{(0,t.validateSocksClientOptions)(r,["connect"])}catch(S){return typeof d=="function"?(d(S),i(S)):b(S)}const u=new l(r);u.connect(r.existing_socket),u.once("established",S=>{u.removeAllListeners(),typeof d=="function"&&d(null,S),i(S)}),u.once("error",S=>{u.removeAllListeners(),typeof d=="function"?(d(S),i(S)):b(S)})})}static createConnectionChain(r,d){return new Promise((i,b)=>E(this,void 0,void 0,function*(){try{(0,t.validateSocksClientChainOptions)(r)}catch(u){return typeof d=="function"?(d(u),i(u)):b(u)}r.randomizeChain&&(0,s.shuffleArray)(r.proxies);try{let u;for(let S=0;S<r.proxies.length;S++){const _=r.proxies[S],n=S===r.proxies.length-1?r.destination:{host:r.proxies[S+1].host||r.proxies[S+1].ipaddress,port:r.proxies[S+1].port},f=yield l.createConnection({command:"connect",proxy:_,destination:n,existing_socket:u});u=u||f.socket}typeof d=="function"?(d(null,{socket:u}),i({socket:u})):i({socket:u})}catch(u){typeof d=="function"?(d(u),i(u)):b(u)}}))}static createUDPFrame(r){const d=new I.SmartBuffer;return d.writeUInt16BE(0),d.writeUInt8(r.frameNumber||0),g.isIPv4(r.remoteHost.host)?(d.writeUInt8(e.Socks5HostType.IPv4),d.writeUInt32BE((0,t.ipv4ToInt32)(r.remoteHost.host))):g.isIPv6(r.remoteHost.host)?(d.writeUInt8(e.Socks5HostType.IPv6),d.writeBuffer((0,t.ipToBuffer)(r.remoteHost.host))):(d.writeUInt8(e.Socks5HostType.Hostname),d.writeUInt8(Buffer.byteLength(r.remoteHost.host)),d.writeString(r.remoteHost.host)),d.writeUInt16BE(r.remoteHost.port),d.writeBuffer(r.data),d.toBuffer()}static parseUDPFrame(r){const d=I.SmartBuffer.fromBuffer(r);d.readOffset=2;const i=d.readUInt8(),b=d.readUInt8();let u;b===e.Socks5HostType.IPv4?u=(0,t.int32ToIpv4)(d.readUInt32BE()):b===e.Socks5HostType.IPv6?u=o.Address6.fromByteArray(Array.from(d.readBuffer(16))).canonicalForm():u=d.readString(d.readUInt8());const S=d.readUInt16BE();return{frameNumber:i,remoteHost:{host:u,port:S},data:d.readBuffer()}}setState(r){this.state!==e.SocksClientState.Error&&(this.state=r)}connect(r){this.onDataReceived=i=>this.onDataReceivedHandler(i),this.onClose=()=>this.onCloseHandler(),this.onError=i=>this.onErrorHandler(i),this.onConnect=()=>this.onConnectHandler();const d=setTimeout(()=>this.onEstablishedTimeout(),this.options.timeout||e.DEFAULT_TIMEOUT);d.unref&&typeof d.unref=="function"&&d.unref(),r?this.socket=r:this.socket=new g.Socket,this.socket.once("close",this.onClose),this.socket.once("error",this.onError),this.socket.once("connect",this.onConnect),this.socket.on("data",this.onDataReceived),this.setState(e.SocksClientState.Connecting),this.receiveBuffer=new a.ReceiveBuffer,r?this.socket.emit("connect"):(this.socket.connect(this.getSocketOptions()),this.options.set_tcp_nodelay!==void 0&&this.options.set_tcp_nodelay!==null&&this.socket.setNoDelay(!!this.options.set_tcp_nodelay)),this.prependOnceListener("established",i=>{setImmediate(()=>{if(this.receiveBuffer.length>0){const b=this.receiveBuffer.get(this.receiveBuffer.length);i.socket.emit("data",b)}i.socket.resume()})})}getSocketOptions(){return Object.assign(Object.assign({},this.options.socket_options),{host:this.options.proxy.host||this.options.proxy.ipaddress,port:this.options.proxy.port})}onEstablishedTimeout(){this.state!==e.SocksClientState.Established&&this.state!==e.SocksClientState.BoundWaitingForConnection&&this.closeSocket(e.ERRORS.ProxyConnectionTimedOut)}onConnectHandler(){this.setState(e.SocksClientState.Connected),this.options.proxy.type===4?this.sendSocks4InitialHandshake():this.sendSocks5InitialHandshake(),this.setState(e.SocksClientState.SentInitialHandshake)}onDataReceivedHandler(r){this.receiveBuffer.append(r),this.processData()}processData(){for(;this.state!==e.SocksClientState.Established&&this.state!==e.SocksClientState.Error&&this.receiveBuffer.length>=this.nextRequiredPacketBufferSize;)if(this.state===e.SocksClientState.SentInitialHandshake)this.options.proxy.type===4?this.handleSocks4FinalHandshakeResponse():this.handleInitialSocks5HandshakeResponse();else if(this.state===e.SocksClientState.SentAuthentication)this.handleInitialSocks5AuthenticationHandshakeResponse();else if(this.state===e.SocksClientState.SentFinalHandshake)this.handleSocks5FinalHandshakeResponse();else if(this.state===e.SocksClientState.BoundWaitingForConnection)this.options.proxy.type===4?this.handleSocks4IncomingConnectionResponse():this.handleSocks5IncomingConnectionResponse();else{this.closeSocket(e.ERRORS.InternalError);break}}onCloseHandler(){this.closeSocket(e.ERRORS.SocketClosed)}onErrorHandler(r){this.closeSocket(r.message)}removeInternalSocketHandlers(){this.socket.pause(),this.socket.removeListener("data",this.onDataReceived),this.socket.removeListener("close",this.onClose),this.socket.removeListener("error",this.onError),this.socket.removeListener("connect",this.onConnect)}closeSocket(r){this.state!==e.SocksClientState.Error&&(this.setState(e.SocksClientState.Error),this.socket.destroy(),this.removeInternalSocketHandlers(),this.emit("error",new s.SocksClientError(r,this.options)))}sendSocks4InitialHandshake(){const r=this.options.proxy.userId||"",d=new I.SmartBuffer;d.writeUInt8(4),d.writeUInt8(e.SocksCommand[this.options.command]),d.writeUInt16BE(this.options.destination.port),g.isIPv4(this.options.destination.host)?(d.writeBuffer((0,t.ipToBuffer)(this.options.destination.host)),d.writeStringNT(r)):(d.writeUInt8(0),d.writeUInt8(0),d.writeUInt8(0),d.writeUInt8(1),d.writeStringNT(r),d.writeStringNT(this.options.destination.host)),this.nextRequiredPacketBufferSize=e.SOCKS_INCOMING_PACKET_SIZES.Socks4Response,this.socket.write(d.toBuffer())}handleSocks4FinalHandshakeResponse(){const r=this.receiveBuffer.get(8);if(r[1]!==e.Socks4Response.Granted)this.closeSocket(`${e.ERRORS.Socks4ProxyRejectedConnection} - (${e.Socks4Response[r[1]]})`);else if(e.SocksCommand[this.options.command]===e.SocksCommand.bind){const d=I.SmartBuffer.fromBuffer(r);d.readOffset=2;const i={port:d.readUInt16BE(),host:(0,t.int32ToIpv4)(d.readUInt32BE())};i.host==="0.0.0.0"&&(i.host=this.options.proxy.ipaddress),this.setState(e.SocksClientState.BoundWaitingForConnection),this.emit("bound",{remoteHost:i,socket:this.socket})}else this.setState(e.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{socket:this.socket})}handleSocks4IncomingConnectionResponse(){const r=this.receiveBuffer.get(8);if(r[1]!==e.Socks4Response.Granted)this.closeSocket(`${e.ERRORS.Socks4ProxyRejectedIncomingBoundConnection} - (${e.Socks4Response[r[1]]})`);else{const d=I.SmartBuffer.fromBuffer(r);d.readOffset=2;const i={port:d.readUInt16BE(),host:(0,t.int32ToIpv4)(d.readUInt32BE())};this.setState(e.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:i,socket:this.socket})}}sendSocks5InitialHandshake(){const r=new I.SmartBuffer,d=[e.Socks5Auth.NoAuth];(this.options.proxy.userId||this.options.proxy.password)&&d.push(e.Socks5Auth.UserPass),this.options.proxy.custom_auth_method!==void 0&&d.push(this.options.proxy.custom_auth_method),r.writeUInt8(5),r.writeUInt8(d.length);for(const i of d)r.writeUInt8(i);this.nextRequiredPacketBufferSize=e.SOCKS_INCOMING_PACKET_SIZES.Socks5InitialHandshakeResponse,this.socket.write(r.toBuffer()),this.setState(e.SocksClientState.SentInitialHandshake)}handleInitialSocks5HandshakeResponse(){const r=this.receiveBuffer.get(2);r[0]!==5?this.closeSocket(e.ERRORS.InvalidSocks5IntiailHandshakeSocksVersion):r[1]===e.SOCKS5_NO_ACCEPTABLE_AUTH?this.closeSocket(e.ERRORS.InvalidSocks5InitialHandshakeNoAcceptedAuthType):r[1]===e.Socks5Auth.NoAuth?(this.socks5ChosenAuthType=e.Socks5Auth.NoAuth,this.sendSocks5CommandRequest()):r[1]===e.Socks5Auth.UserPass?(this.socks5ChosenAuthType=e.Socks5Auth.UserPass,this.sendSocks5UserPassAuthentication()):r[1]===this.options.proxy.custom_auth_method?(this.socks5ChosenAuthType=this.options.proxy.custom_auth_method,this.sendSocks5CustomAuthentication()):this.closeSocket(e.ERRORS.InvalidSocks5InitialHandshakeUnknownAuthType)}sendSocks5UserPassAuthentication(){const r=this.options.proxy.userId||"",d=this.options.proxy.password||"",i=new I.SmartBuffer;i.writeUInt8(1),i.writeUInt8(Buffer.byteLength(r)),i.writeString(r),i.writeUInt8(Buffer.byteLength(d)),i.writeString(d),this.nextRequiredPacketBufferSize=e.SOCKS_INCOMING_PACKET_SIZES.Socks5UserPassAuthenticationResponse,this.socket.write(i.toBuffer()),this.setState(e.SocksClientState.SentAuthentication)}sendSocks5CustomAuthentication(){return E(this,void 0,void 0,function*(){this.nextRequiredPacketBufferSize=this.options.proxy.custom_auth_response_size,this.socket.write(yield this.options.proxy.custom_auth_request_handler()),this.setState(e.SocksClientState.SentAuthentication)})}handleSocks5CustomAuthHandshakeResponse(r){return E(this,void 0,void 0,function*(){return yield this.options.proxy.custom_auth_response_handler(r)})}handleSocks5AuthenticationNoAuthHandshakeResponse(r){return E(this,void 0,void 0,function*(){return r[1]===0})}handleSocks5AuthenticationUserPassHandshakeResponse(r){return E(this,void 0,void 0,function*(){return r[1]===0})}handleInitialSocks5AuthenticationHandshakeResponse(){return E(this,void 0,void 0,function*(){this.setState(e.SocksClientState.ReceivedAuthenticationResponse);let r=!1;this.socks5ChosenAuthType===e.Socks5Auth.NoAuth?r=yield this.handleSocks5AuthenticationNoAuthHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===e.Socks5Auth.UserPass?r=yield this.handleSocks5AuthenticationUserPassHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===this.options.proxy.custom_auth_method&&(r=yield this.handleSocks5CustomAuthHandshakeResponse(this.receiveBuffer.get(this.options.proxy.custom_auth_response_size))),r?this.sendSocks5CommandRequest():this.closeSocket(e.ERRORS.Socks5AuthenticationFailed)})}sendSocks5CommandRequest(){const r=new I.SmartBuffer;r.writeUInt8(5),r.writeUInt8(e.SocksCommand[this.options.command]),r.writeUInt8(0),g.isIPv4(this.options.destination.host)?(r.writeUInt8(e.Socks5HostType.IPv4),r.writeBuffer((0,t.ipToBuffer)(this.options.destination.host))):g.isIPv6(this.options.destination.host)?(r.writeUInt8(e.Socks5HostType.IPv6),r.writeBuffer((0,t.ipToBuffer)(this.options.destination.host))):(r.writeUInt8(e.Socks5HostType.Hostname),r.writeUInt8(this.options.destination.host.length),r.writeString(this.options.destination.host)),r.writeUInt16BE(this.options.destination.port),this.nextRequiredPacketBufferSize=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.socket.write(r.toBuffer()),this.setState(e.SocksClientState.SentFinalHandshake)}handleSocks5FinalHandshakeResponse(){const r=this.receiveBuffer.peek(5);if(r[0]!==5||r[1]!==e.Socks5Response.Granted)this.closeSocket(`${e.ERRORS.InvalidSocks5FinalHandshakeRejected} - ${e.Socks5Response[r[1]]}`);else{const d=r[3];let i,b;if(d===e.Socks5HostType.IPv4){const u=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<u){this.nextRequiredPacketBufferSize=u;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(u).slice(4)),i={host:(0,t.int32ToIpv4)(b.readUInt32BE()),port:b.readUInt16BE()},i.host==="0.0.0.0"&&(i.host=this.options.proxy.ipaddress)}else if(d===e.Socks5HostType.Hostname){const u=r[4],S=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(u);if(this.receiveBuffer.length<S){this.nextRequiredPacketBufferSize=S;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(S).slice(5)),i={host:b.readString(u),port:b.readUInt16BE()}}else if(d===e.Socks5HostType.IPv6){const u=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<u){this.nextRequiredPacketBufferSize=u;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(u).slice(4)),i={host:o.Address6.fromByteArray(Array.from(b.readBuffer(16))).canonicalForm(),port:b.readUInt16BE()}}this.setState(e.SocksClientState.ReceivedFinalResponse),e.SocksCommand[this.options.command]===e.SocksCommand.connect?(this.setState(e.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:i,socket:this.socket})):e.SocksCommand[this.options.command]===e.SocksCommand.bind?(this.setState(e.SocksClientState.BoundWaitingForConnection),this.nextRequiredPacketBufferSize=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.emit("bound",{remoteHost:i,socket:this.socket})):e.SocksCommand[this.options.command]===e.SocksCommand.associate&&(this.setState(e.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:i,socket:this.socket}))}}handleSocks5IncomingConnectionResponse(){const r=this.receiveBuffer.peek(5);if(r[0]!==5||r[1]!==e.Socks5Response.Granted)this.closeSocket(`${e.ERRORS.Socks5ProxyRejectedIncomingBoundConnection} - ${e.Socks5Response[r[1]]}`);else{const d=r[3];let i,b;if(d===e.Socks5HostType.IPv4){const u=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<u){this.nextRequiredPacketBufferSize=u;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(u).slice(4)),i={host:(0,t.int32ToIpv4)(b.readUInt32BE()),port:b.readUInt16BE()},i.host==="0.0.0.0"&&(i.host=this.options.proxy.ipaddress)}else if(d===e.Socks5HostType.Hostname){const u=r[4],S=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(u);if(this.receiveBuffer.length<S){this.nextRequiredPacketBufferSize=S;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(S).slice(5)),i={host:b.readString(u),port:b.readUInt16BE()}}else if(d===e.Socks5HostType.IPv6){const u=e.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<u){this.nextRequiredPacketBufferSize=u;return}b=I.SmartBuffer.fromBuffer(this.receiveBuffer.get(u).slice(4)),i={host:o.Address6.fromByteArray(Array.from(b.readBuffer(16))).canonicalForm(),port:b.readUInt16BE()}}this.setState(e.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:i,socket:this.socket})}}get socksClientOptions(){return Object.assign({},this.options)}}c.SocksClient=l})(G)),G}var pe;function Ve(){return pe||(pe=1,(function(c){var E=j&&j.__createBinding||(Object.create?(function(g,I,e,t){t===void 0&&(t=e);var a=Object.getOwnPropertyDescriptor(I,e);(!a||("get"in a?!I.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return I[e]}}),Object.defineProperty(g,t,a)}):(function(g,I,e,t){t===void 0&&(t=e),g[t]=I[e]})),m=j&&j.__exportStar||function(g,I){for(var e in g)e!=="default"&&!Object.prototype.hasOwnProperty.call(I,e)&&E(I,g,e)};Object.defineProperty(c,"__esModule",{value:!0}),m(Fe(),c)})(j)),j}var Se;function $e(){if(Se)return y;Se=1;var c=y&&y.__createBinding||(Object.create?(function(u,S,_,n){n===void 0&&(n=_);var f=Object.getOwnPropertyDescriptor(S,_);(!f||("get"in f?!S.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return S[_]}}),Object.defineProperty(u,n,f)}):(function(u,S,_,n){n===void 0&&(n=_),u[n]=S[_]})),E=y&&y.__setModuleDefault||(Object.create?(function(u,S){Object.defineProperty(u,"default",{enumerable:!0,value:S})}):function(u,S){u.default=S}),m=y&&y.__importStar||function(u){if(u&&u.__esModule)return u;var S={};if(u!=null)for(var _ in u)_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)&&c(S,u,_);return E(S,u),S},g=y&&y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(y,"__esModule",{value:!0}),y.SocksProxyAgent=void 0;const I=Ve(),e=ye(),t=g(Ce()),a=m(Te),s=m(Y),o=m(Ne),l=Ue,B=(0,t.default)("socks-proxy-agent"),r=u=>u.servername===void 0&&u.host&&!s.isIP(u.host)?{...u,servername:u.host}:u;function d(u){let S=!1,_=5;const n=u.hostname,f=parseInt(u.port,10)||1080;switch(u.protocol.replace(":","")){case"socks4":S=!0,_=4;break;case"socks4a":_=4;break;case"socks5":S=!0,_=5;break;case"socks":_=5;break;case"socks5h":_=5;break;default:throw new TypeError(`A "socks" protocol must be specified! Got: ${String(u.protocol)}`)}const h={host:n,port:f,type:_};return u.username&&Object.defineProperty(h,"userId",{value:decodeURIComponent(u.username),enumerable:!1}),u.password!=null&&Object.defineProperty(h,"password",{value:decodeURIComponent(u.password),enumerable:!1}),{lookup:S,proxy:h}}class i extends e.Agent{constructor(S,_){super(_);const n=typeof S=="string"?new l.URL(S):S,{proxy:f,lookup:h}=d(n);this.shouldLookup=h,this.proxy=f,this.timeout=_?.timeout??null,this.socketOptions=_?.socketOptions??null}async connect(S,_){const{shouldLookup:n,proxy:f,timeout:h}=this;if(!_.host)throw new Error("No `host` defined!");let{host:p}=_;const{port:v,lookup:R=a.lookup}=_;n&&(p=await new Promise((x,$)=>{R(p,{},(z,ke)=>{z?$(z):x(ke)})}));const w={proxy:f,destination:{host:p,port:typeof v=="number"?v:parseInt(v,10)},command:"connect",timeout:h??void 0,socket_options:this.socketOptions??void 0},H=x=>{S.destroy(),P.destroy(),x&&x.destroy()};B("Creating socks proxy connection: %o",w);const{socket:P}=await I.SocksClient.createConnection(w);if(B("Successfully created socks proxy connection"),h!==null&&(P.setTimeout(h),P.on("timeout",()=>H())),_.secureEndpoint){B("Upgrading socket connection to TLS");const x=o.connect({...b(r(_),"host","path","port"),socket:P});return x.once("error",$=>{B("Socket TLS error",$.message),H(x)}),x}return P}}i.protocols=["socks","socks4","socks4a","socks5","socks5h"],y.SocksProxyAgent=i;function b(u,...S){const _={};let n;for(n in u)S.includes(n)||(_[n]=u[n]);return _}return y}var ve=$e();const Ge=Re(ve),et=Pe({__proto__:null,default:Ge},[ve]);export{et as i};
