import{g as j}from"./index-DCGLMVTV.js";import $ from"net";import R from"tls";import{r as A,a as S}from"./index-BveCBdm5.js";import C from"events";import M from"url";function B(f,h){for(var u=0;u<h.length;u++){const i=h[u];if(typeof i!="string"&&!Array.isArray(i)){for(const a in i)if(a!=="default"&&!(a in f)){const l=Object.getOwnPropertyDescriptor(i,a);l&&Object.defineProperty(f,a,l.get?l:{enumerable:!0,get:()=>i[a]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}var s={},O;function U(){if(O)return s;O=1;var f=s&&s.__createBinding||(Object.create?(function(r,t,e,o){o===void 0&&(o=e);var n=Object.getOwnPropertyDescriptor(t,e);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,o,n)}):(function(r,t,e,o){o===void 0&&(o=e),r[o]=t[e]})),h=s&&s.__setModuleDefault||(Object.create?(function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}):function(r,t){r.default=t}),u=s&&s.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var e in r)e!=="default"&&Object.prototype.hasOwnProperty.call(r,e)&&f(t,r,e);return h(t,r),t},i=s&&s.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(s,"__esModule",{value:!0}),s.HttpProxyAgent=void 0;const a=u($),l=u(R),P=i(A()),v=C,D=S(),g=M,c=(0,P.default)("http-proxy-agent");class y extends D.Agent{constructor(t,e){super(e),this.proxy=typeof t=="string"?new g.URL(t):t,this.proxyHeaders=e?.headers??{},c("Creating new HttpProxyAgent instance: %o",this.proxy.href);const o=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),n=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...e?w(e,"headers"):null,host:o,port:n}}addRequest(t,e){t._header=null,this.setRequestProps(t,e),super.addRequest(t,e)}setRequestProps(t,e){const{proxy:o}=this,n=e.secureEndpoint?"https:":"http:",p=t.getHeader("host")||"localhost",H=`${n}//${p}`,x=new g.URL(t.path,H);e.port!==80&&(x.port=String(e.port)),t.path=String(x);const d=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(o.username||o.password){const _=`${decodeURIComponent(o.username)}:${decodeURIComponent(o.password)}`;d["Proxy-Authorization"]=`Basic ${Buffer.from(_).toString("base64")}`}d["Proxy-Connection"]||(d["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const _ of Object.keys(d)){const b=d[_];b&&t.setHeader(_,b)}}async connect(t,e){t._header=null,t.path.includes("://")||this.setRequestProps(t,e);let o,n;c("Regenerating stored HTTP header string for request"),t._implicitHeader(),t.outputData&&t.outputData.length>0&&(c("Patching connection write() output buffer with updated header"),o=t.outputData[0].data,n=o.indexOf(`\r
\r
`)+4,t.outputData[0].data=t._header+o.substring(n),c("Output buffer: %o",t.outputData[0].data));let p;return this.proxy.protocol==="https:"?(c("Creating `tls.Socket`: %o",this.connectOpts),p=l.connect(this.connectOpts)):(c("Creating `net.Socket`: %o",this.connectOpts),p=a.connect(this.connectOpts)),await(0,v.once)(p,"connect"),p}}y.protocols=["http","https"],s.HttpProxyAgent=y;function w(r,...t){const e={};let o;for(o in r)t.includes(o)||(e[o]=r[o]);return e}return s}var m=U();const E=j(m),N=B({__proto__:null,default:E},[m]);export{N as i};
